import { useData } from "nextra/data";

export const getStaticProps = async () => {
  const res = await fetch(
    "https://mainnet-beta.api.drift.trade/stats/perpMarketAccounts"
  );
  const data = await res.json();

  const perpMarginData = data.result.map((market, index) => {
    return {
      index,
      name: market.name
        .map((charCode) => String.fromCharCode(charCode))
        .join("")
        .trim(),
      marginRatioInitial: market.marginRatioInitial,
      marginRatioMaintenance: market.marginRatioMaintenance,
      imfFactor: market.imfFactor,
    };
  });

  return {
    props: {
      ssg: {
        perpMarginData,
      },
    },
    revalidate: 3600, // Rebuild page every hr
  };
};

export const PerpMarginTable = () => {
  const { perpMarginData } = useData();

  const headings = [
    "Index",
    "Market",
    "marginRatioInitial",
    "marginRatioMaintenance",
    "imfFactor",
  ];

  return (
    <table>
      <thead>
        <tr>
          {headings.map((heading) => (
            <th key={heading}>{heading}</th>
          ))}
        </tr>
      </thead>
      <tbody>
        {perpMarginData.map((row) => (
          <tr key={row.index}>
            <td>{row.index}</td>
            <td>{row.name}</td>
            <td>{row.marginRatioInitial}</td>
            <td>{row.marginRatioMaintenance}</td>
            <td>{row.imfFactor}</td>
          </tr>
        ))}
      </tbody>
    </table>
  );
};

# Margin Requirements

Below is a table for initial and maintenance margin requirements for each market. Pulled directly from the protocolâ€™s on-chain state.

These values include:
- **Initial Margin Ratio** (`marginRatioInitial`)
- **Maintenance Margin Ratio** (`marginRatioMaintenance`)
- **IMF Factor**, which affects leverage at higher notional sizes

Data below is updated every hour from `PerpMarketAccount`.

### Perpetual Markets

<PerpMarginTable />

---

Note: All values shown are raw
